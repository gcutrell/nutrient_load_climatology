<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>

    <script src="data.js"></script>
    <script src="climatology.js"></script>


    <script>

        function loadData() {

            var tp = new Array();
            var drp = new Array();

            for (i = 0; i < dailyData.length; i++) {
                var date = new Date(Date.parse(dailyData[i][0]));
                tp[i] = [date, dailyData[i][1]];
                drp[i] = [date, dailyData[i][2]];
            }
            return [["TP", tp], ["DRP", drp]];
        }

        function loadPlotData(data, dataset, startDay) {

            var aYear = grabAYear(data[dataset][1], 1, startDay, 2015, true);

            var stats = generateStats(data[dataset][1], 1, startDay, true);
            var d1 = [];
            var d2 = [];
            var d3 = [];
            var d4 = [];
            var d5 = [];
            var d6 = [];
            for (i = 0; i < 365; i++) {

                date = Date.UTC(1970, 0, i + startDay);
                d1.push([date, stats[4][i] - stats[3][i]]);
                d2.push([date, stats[3][i] - stats[2][i]]);
                d3.push([date, stats[2][i] - stats[1][i]]);
                d4.push([date, stats[1][i] - stats[0][i]]);
                d5.push([date, stats[0][i]]);
                if (i < aYear.length) {
                    d6.push([date, aYear[i]]);
                }
            }

            return [
                {type: "area", name: "max", data: d1, linecolor: "#A0A0A0", color: '#F0F0F0'},
                {type: "area", name: "75%ile", data: d2, color: '#D0D0D0'},
                {type: "area", name: "mean", data: d3, color: '#D0D0D0'},
                {type: "area", name: "25%ile", data: d4, color: '#F0F0F0'},
                {type: "area", name: "min", data: d5, color: '#FFFFFF'},
                {type: "line", name: "2007", data: d6, color: '#004400', linewidth: 2}
            ];


        }


        $(function () {

            var data = loadData();

            var startDay = 59;
            var startMonth = 2;
            var monthTickPositions = [];
            for (i = 0; i < 6; i++) {
                monthTickPositions.push(Date.UTC(1970, startMonth + i, 0))
            }

            $("#display").selectmenu({
                change: function (event, data) {

                    if (data.item.value == "Total Phosphorus") {
                        plotData = loadPlotData(data, 0, startDay)
                    } else if (data.item.value == "Dissolved Reactive Phosphorus") {
                        plotData = loadPlotData(data, 1, startDay)
                    }
                    $('#container').highcharts.redraw();

                }
            })
            ;

            var plotData = loadPlotData(data, 0, startDay);

            $('#container').highcharts({
                chart: {
                    type: 'area'
                },

                credits: {
                    enabled: false
                },

                title: {
                    text: 'Cumulative Total Phosphorus Load from Maumee River to Western Lake Erie Basin',
                },
                subtitle: {
                    text: '(March 1 to April 20, 2015)'
                },
                xAxis: {
                    min: Date.UTC(1970, startMonth, 0),
                    max: Date.UTC(1970, startMonth + 5, 0),
                    tickPositions: monthTickPositions,
                    gridLineWidth: 1,

                    labels: {
                        formatter: function () {
                            if (this.isFirst) return null;
                            var date = new Date(this.value);
                            return date.toLocaleString("en-us", {month: "short"})
                        },
                        x: -80
                    }
                },
                yAxis: {
                    title: {
                        text: 'TP (metric tons)'
                    },
                    labels: {
                        formatter: function () {
                            return this.value;
                        }
                    }
                },
                tooltip: {
                    shared: true
                },
                plotOptions: {
                    area: {
                        stacking: 'normal',
                        lineColor: '#666666',
                        lineWidth: 1,
                        marker: {
                            lineWidth: 1,
                            lineColor: '#666666'
                        }
                    }
                },
                series: plotData
            });
        })
        ;
    </script>

    <style>
        fieldset {
            border: 0;
        }

        label {
            display: block;
            margin: 30px 0 0 0;
        }

        select {
            width: 200px;
        }

        .overflow {
            height: 200px;
        }
    </style>
</head>

<h2>Cumulative 2015 Maumee River Discharge and Nutrient Loads</h2>

<p>Last updated 4/27/2015; next update scheduled for 5/4/2015.</p>

<table>
    <tr>
        <td>
            <p>Flow (4/27/2015): <br>
                Total Phosphorus (4/20/2015): 4,500 lb (7% above 2000-2014 average) <br>
                Dissolved Reactive Phosphorus (4/20/2015): 1,234 lb (5% below 2000-2014 average)
            </p>
        </td>
        <td>
            <form action="#">

                <fieldset>
                    <label for="display">Display</label>
                    <select name="display" id="display">
                        <option selected="" selected
                        ">Total Phosphorus</option>
                        <option>Dissolved Reactive Phosphorus</option>
                        <option>Flow</option>
                    </select>

                    <label for="Year">Year</label>
                    <select name="year" id="year">
                        <option selected="" selected
                        ">none</option>
                        <option>2000</option>
                        <option>2001</option>
                    </select>
                </fieldset>

            </form>
        </td>
    </tr>
</table>
<div id="container" style="width: 900px; height: 600px; margin: 0 auto"></div>

<p>The extent and severity of algal blooms in the Western Lake Erie Basin (WLEB) have been shown to be correlated with
    the amount of nutrients (nutrient load) entering the WLEB from the Maumee River Watershed through the Maumee River.
    Measurements of the concentration of nutrients in the Maumee River are collected by Heidelberg University and
    combined with USGS measurements of Maumee River flow to calculate daily nutrient loads. This web page’s tracking
    tool sums up nutrient loads day-to-day to show the current year’s total nutrient load entering the WLEB through the
    Maumee River, and charts the cumulative loads in the context of previous (2000-2014) years’ ranges.
</p>

<p>Heidelberg University retrieves water samples and performs laboratory analyses of the samples’ water chemistry on a
    regular schedule. During the critical spring and summer seasons of 2015, Heidelberg plans to publish analytical
    results and calculated daily loads on a weekly basis. The intensive schedule, along with development and
    implementation of this web page in partnership with the Great Lakes Observing System, is supported by the Great
    Lakes Restoration Initiative and the National Oceanic and Atmospheric Agency’s Great Lakes Environmental Research
    Laboratory.

<p>
    Much more information is available from the following links:
</p>
</body>
</html>